<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reading Comprehension Experiment</title>
  <style>
    body.light { background: #ffffff; color: #000000; }
    body.dark { background: #121212; color: #ffffff; }
    body.grey { background: #e0e0e0; color: #000000; }
    .container { max-width: 700px; margin: auto; padding: 2em; font-family: sans-serif; }
    .hidden { display: none; }
    textarea { width: 100%; height: 4em; }
    button { margin-top: 1em; padding: 0.5em 1em; font-size: 1em; }
  </style>
</head>
<body class="grey">
  <div class="container">
    <h1>Reading Study (Georgia Tech)</h1>
    <div id="consent">
      <p>You will read a short passage in either dark or light mode and answer comprehension and comfort questions. Anonymous. Takes ~5 min.</p>
      <label><input type="checkbox" id="agree"> I consent to participate.</label><br>
      <button onclick="startStudy()">Begin</button>
    </div>

    <div id="reading" class="hidden">
      <h2>Reading Passage</h2>
      <p id="passage"></p>
      <button onclick="showQuiz()">I'm done reading</button>
    </div>

    <div id="quiz" class="hidden">
      <h2>Comprehension Check</h2>
      <p>Which airline is the passage about?</p>
      <label><input type="radio" name="q1" value="Delta Airlines"> A) Delta Airlines</label><br>
      <label><input type="radio" name="q1" value="India Airlines"> B) India Airlines</label><br>
      <label><input type="radio" name="q1" value="United Airlines"> C) United Airlines</label><br>
      <label><input type="radio" name="q1" value="Southwest Airlines"> D) Southwest Airlines</label><br>
      <label><input type="radio" name="q1" value="Boeing"> E) Boeing</label>

      <h2>Comfort Survey Rating 1 - 5 (1 = very easy, 5 = very difficult)</h2>
      <ol>
        <li>Reading was easy: <input type="number" min="1" max="5"></li>
        <li>I felt comfortable: <input type="number" min="1" max="5"></li>
        <li>I experienced eye strain: <input type="number" min="1" max="5"></li>
        <li>I liked this mode: <input type="number" min="1" max="5"></li>
      </ol>

      <p>Additional comments:<br><textarea></textarea></p>
      <button onclick="submitForm()">Submit</button>
    </div>
  </div>

  <script>
    const passages = {
      light: `Boeing Incident – June 2025
              In June 2025, a Boeing 737 Max aircraft operated by a regional airline experienced a mid-air systems failure, forcing an emergency landing. The plane lost partial control due to a malfunction in the flight management software, although pilots were able to land safely with no injuries reported. The FAA and Boeing immediately began a joint investigation, with preliminary findings pointing to faulty software updates. This incident reignited concerns over the 737 Max line, which had previously been grounded in 2019. Industry experts called for stricter oversight of autonomous flight systems and real-time diagnostic monitoring.

              Citation:
              [1] B. Baker, “Boeing 737 Max makes emergency landing in June incident,” BBC News, Jun. 9, 2025. [Online]. Available: https://www.bbc.com/news/business-boeing737
              `,

      dark: `Boeing Incident – June 2025
              In June 2025, a Boeing 737 Max aircraft operated by a regional airline experienced a mid-air systems failure, forcing an emergency landing. The plane lost partial control due to a malfunction in the flight management software, although pilots were able to land safely with no injuries reported. The FAA and Boeing immediately began a joint investigation, with preliminary findings pointing to faulty software updates. This incident reignited concerns over the 737 Max line, which had previously been grounded in 2019. Industry experts called for stricter oversight of autonomous flight systems and real-time diagnostic monitoring.

              Citation:
              [1] B. Baker, “Boeing 737 Max makes emergency landing in June incident,” BBC News, Jun. 9, 2025. [Online]. Available: https://www.bbc.com/news/business-boeing737
              `
    };

    let mode;
    let startTime;

    function startStudy() {
      if (!document.getElementById('agree').checked) {
        alert("You must consent to proceed.");
        return;
      }

      mode = Math.random() < 0.5 ? 'light' : 'dark';
      document.body.classList.remove("grey");
      document.body.classList.add(mode);
      document.getElementById('consent').classList.add('hidden');
      document.getElementById('reading').classList.remove('hidden');
      document.getElementById('passage').innerText = passages[mode];
      startTime = new Date();
    }

    function showQuiz() {
      document.getElementById('reading').classList.add('hidden');
      document.getElementById('quiz').classList.remove('hidden');
      document.body.classList.remove("light", "dark");
      document.body.classList.add("grey");
    }

    function submitForm() {
      const duration = (new Date() - startTime) / 1000;
      const selectedOption = document.querySelector('input[name="q1"]:checked');
      const data = {
        mode: mode,
        time: duration.toFixed(2),
        q1: selectedOption ? selectedOption.value : "Not answered",
        ease: document.querySelectorAll('input[type=number]')[0].value,
        comfort: document.querySelectorAll('input[type=number]')[1].value,
        strain: document.querySelectorAll('input[type=number]')[2].value,
        preference: document.querySelectorAll('input[type=number]')[3].value,
        comments: document.querySelector('textarea').value
      };

      fetch("https://script.google.com/macros/s/AKfycbwJPQ7SydHcybbDAiPXMdbvao7TEPSH34uHHumhbD_MOr8R2LOc-D7Nn1k-ozLSpVD2/exec", {
        method: "POST",
        headers: { "Content-Type": "text/plain" },
        body: JSON.stringify(data)
      }).then(res => {
        if (res.ok) {
          alert("Thank you for your submission!");
          location.reload();
        } else {
          alert("Submission failed. Please try again later.");
        }
      }).catch(error => {
        alert("Error submitting form. Please try again.");
        console.error(error);
      });
    }
  </script>
</body>
</html>
